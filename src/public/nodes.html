<!DOCTYPE xhtml>
<html lang="en">

<head>
	<script src="vendor/scripts/jquery.js"></script>
	<script src="vendor/scripts/sigma.min.js"></script>
	<script src="vendor/scripts/sigma.forceatlas2.js"></script>
	<link rel="stylesheet" href="vendor/stylesheets/bootstrap.css">
</head>

<body>
	<script type="text/javascript">
		function randColor() {
		r = Math.round(Math.random() * 256);
		g = Math.round(Math.random() * 256);
		b = Math.round(Math.random() * 256);
		if(Math.abs(r-g) < 50 && Math.abs(g-b) < 50  && Math.abs(b-r) < 50)
			return randColor();
		else
			return 'rgb('+r+','+g+','+b+')';
		}
		var animating = false;
		$(document).ready(function() {
			$.ajax({
				url: "/nodes",
				dataType: 'json'
			}).done(function(data) {
				var sigInst =  sigma.init(document.getElementById('graph')).drawingProperties({
						defaultLabelColor: '#fff',
						defaultLabelSize: 14,
						defaultLabelBGColor: '#fff',
						defaultLabelHoverColor: '#000',
						labelThreshold: 6,
						defaultEdgeType: 'curve'
					}).graphProperties({
						minNodeSize: 0.5,
						maxNodeSize: 5,
						minEdgeSize: 1,
						maxEdgeSize: 1
					}).mouseProperties({
						maxRatio: 4
					});
				for(node in data) {
					sigInst = sigInst.addNode(node,{
						'x': Math.random(),
						'y': Math.random(),
						'color': randColor()
					});
				}

				var addedNodes = [];
				for(node in data) {
					for(i in data[node]) {
						if (!addedNodes[node])
							addedNodes[node] = [];
						if (!addedNodes[data[node][i]])
							addedNodes[data[node][i]] = [];
						if (!addedNodes[data[node][i]][node]) {
							sigInst = sigInst.addEdge(node +'_'+ data[node][i], node, data[node][i])
							addedNodes[data[node][i]][node] = true;
							addedNodes[node][data[node][i]] = true;
						}
					}
				}
				console.log(addedNodes);

				sigInst.draw();
				sigInst.startForceAtlas2();
				animating = true;

				// Stop layout algorithm after 10 seconds
				setTimeout(function(){
					sigInst.stopForceAtlas2();
					animating = false;
				}, 5000)
			});
		});
	</script>
	<div id="graph" style="width: 100%; height:100%;"></div>
</body>

</html>